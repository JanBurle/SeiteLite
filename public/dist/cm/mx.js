class MxParser{tx;constructor(t){t=(t=t.split(/\r?\n/).map((t=>t.trim())).join("\n")).replace(/\n{2,}/g,"[br]"),this.tx=t.replace(/\n/g," ").trim()}_entities(){let t={amp:/&/g,lt:/</g,gt:/>/g,"#34":/\\"/g,"#39":/\\'/g,"#91":/\\\[/g,"#58":/\\\:/g,"#93":/\\\]/g,"#40":/\\\(/g,"#41":/\\\)/g,"#95":/\\\_/g,"#126":/\\\~/g},e=this.tx;for(let r in t)e=e.replace(t[r],`&${r};`);this.tx=e.replace(/(?<=(?:[a-zA-Z0-9])):\/\//g,"&#58;//")}_readTo(...t){let e=this.tx,r=-1;for(let s of t){let t=e.indexOf(s);-1<t&&(r<0||t<r)&&(r=t)}let s="";return r<0?(s=e,this.tx=""):(s=e.substring(0,r),this.tx=e.substring(r)),s}_readTag(){let t="",e="",r=this._readTo("[","]"),s=()=>this.tx=this.tx.substring(1),a=t=>t==this.tx[0];switch(this.tx[0]){case"[":s(),t=this._readTo(":","]").trim(),a(":")&&(s(),a(" ")&&s());break;case"]":s(),t="]",a("(")&&(s(),e=this._readTo(")"),s())}return[r,t,e]}_splitTag(t){let[e="",r=""]=t.split("/"),[s="",a=""]=e.split(".");return[s,a,r]}_parseTag(t,e,r){if(!t)return e;let[s,a,i]=this._splitTag(t);s||="span",a=a?` class="${a}"`:"";let l=(t=>t.replace(/&quot;/g,'"').replace(/&#39;/g,"'"))(i).split(" ").filter((t=>t));if(i=l.join(" "),i=i?" "+i:"",r||="","-"==s[0])return"";switch(s){case"star":return"<sup>*</sup>";case"br":return"<br>";case"hr":return`<hr${a}>`;case"a":return e||=r,r||=e,`<a${a} href="${r}"${l.includes("blank")?' target="_blank"':""}>${e}</a>`;case"mailto":return e||=r,r||=e,`<a${a} href="mailto:${r}">${e}</a>`;case"tel":return e||=r,r||=e,`<a${a} href="tel:${r=r.replace(/\s+/g,"")}">${e}</a>`;case"img":return`<img${a}${i} src="${r}" alt="">`;case"th2":return`<th colspan="2"${a}>${e}</th>`;case"td2":return`<td colspan="2"${a}>${e}</td>`;case"ico":return`<s-ico ${e}${a}></s-ico>`}let n={div:"div",span:"span",b:"b",i:"i",u:"u",h1:"h1",h2:"h2",h3:"h3",ul:"ul",ol:"ol",li:"li",row:"f-row",table:"table",tr:"tr",th:"th",td:"td",btn:"s-btn"}[s];return n?`<${n}${a}${i}${r=r?" "+r:""}>${e}</${n}>`:e}_parse(t){let e={"@34":/"/g,"@39":/'/g,nbsp:/_/g,"‑":/~/g},r="";for(;;){let[s,a,i]=this._readTag();for(let t in e)s=s.replace(e[t],`&${t};`);if(r+=s,!a)return r;if("]"===a)return this._parseTag(t,r,i);r+=this._parse(a)}}mx(){this._entities();let t={"&@34;":["„","“"],"&@39;":["‚","‘"]};return(t=>{let e=[[/&#34;/g,'"'],[/&#39;/g,"'"],[/&#91;/g,"["],[/&#58;/g,":"],[/&#93;/g,"]"],[/&#40;/g,"("],[/&#41;/g,")"],[/&#95;/g,"_"],[/&#126;/g,"~"]];for(let[r,s]of e)t=t.replace(r,s);return t})((e=>{for(let r in t){let s=0;for(;;){let a=e.indexOf(r);if(-1==a)break;e=e.substring(0,a)+t[r][s]+e.substring(a+r.length),s=s?0:1}}return e})(this._parse("")))}}function mx(t){return new MxParser(t).mx()}export default mx;